var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _react=_interopRequireDefault(require("react"));var _enzyme=require("enzyme");var _enzymeToJson=_interopRequireDefault(require("enzyme-to-json"));var _utils=require("ts-jest/utils");var _index=_interopRequireDefault(require("../index"));var _utils2=require("../../../tests/utils");var _handleFileInfo=_interopRequireDefault(require("../utils/handleFileInfo"));var _this=this,_jsxFileName="/Users/linji/Documents/workspace/zarm/zarm/components/file-picker/__tests__/index.test.tsx";jest.mock('../utils/handleFileInfo');var mHandleFileInfo=(0,_utils.mocked)(_handleFileInfo.default);describe('file picker',function(){it('render correctly',function(){var props={onChange:jest.fn(),children:_react.default.createElement("button",{__self:_this,__source:{fileName:_jsxFileName,lineNumber:17,columnNumber:17}},"add")};var wrapper=(0,_enzyme.render)(_react.default.createElement(_index.default,(0,_extends2.default)({},props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:19,columnNumber:28}})));expect((0,_enzymeToJson.default)(wrapper)).toMatchSnapshot();});});describe('file picker event',function(){var props={accept:'image/jpg, image/jpeg, image/gif, image/png',onChange:jest.fn(),quality:0.3,children:_react.default.createElement("button",{__self:_this,__source:{fileName:_jsxFileName,lineNumber:29,columnNumber:15}},"add")};var mCreateObjectURL=jest.fn();var file=new File([''],'./test.jpg',{type:'image/jpeg'});var mFileDetail={file:file,fileType:file.type,fileName:file.name,fileSize:file.size,thumbnail:'data:,'};beforeAll(function(){(0,_utils2.mockCreateObjectURL)(mCreateObjectURL);});afterAll(function(){(0,_utils2.mockResetCreateObjectURL)();});afterEach(function(){jest.clearAllMocks();});it('select image & onBeforeSelect is not func',function(){var _props=(0,_extends2.default)({},props,{multiple:true,onBeforeSelect:false});mHandleFileInfo.mockImplementation(function(_,callback){callback(mFileDetail);});var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,(0,_extends2.default)({},_props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:60,columnNumber:27}})));var mClickEvent={preventDefault:jest.fn()};wrapper.find('.za-file-picker__input').simulate('click',mClickEvent);expect(mClickEvent.preventDefault).not.toBeCalled();wrapper.find('.za-file-picker__input').simulate('change',{target:{files:[file]}});expect(props.onChange).toBeCalledWith([mFileDetail]);expect(props.onChange).toBeCalledTimes(1);});it('should handle change event if files is an array of File instance',function(){var getFileInfo;mHandleFileInfo.mockImplementation(function(_,callback){getFileInfo=callback;callback(mFileDetail);});var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,(0,_extends2.default)({},props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:79,columnNumber:27}})));wrapper.find('.za-file-picker__input').simulate('change',{target:{files:[file]}});expect(mHandleFileInfo).toBeCalledWith({file:file,quality:0.3},getFileInfo);expect(props.onChange).toBeCalledWith(mFileDetail);});it('click children',function(){var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,(0,_extends2.default)({},props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:89,columnNumber:27}})));wrapper.find('button').simulate('click');wrapper.find('.za-file-picker__input').simulate('change',{target:{files:[file]}});expect(props.onChange).toBeCalled();});});describe('file picker disabled',function(){var props={accept:'image/jpg, image/jpeg, image/gif, image/png',onChange:jest.fn(),onBeforeSelect:jest.fn(),children:_react.default.createElement("button",{__self:_this,__source:{fileName:_jsxFileName,lineNumber:104,columnNumber:15}},"foo")};it('on before select return false',function(){var _props=(0,_extends2.default)({},props,{onBeforeSelect:jest.fn(function(){return false;})});var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,(0,_extends2.default)({},_props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:113,columnNumber:27}})));wrapper.find('.za-file-picker__input').simulate('click');expect(props.onChange).not.toHaveBeenCalled();});it('disabled',function(){var _props=(0,_extends2.default)({},props,{disabled:true});var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,(0,_extends2.default)({},_props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:125,columnNumber:27}})));wrapper.find('.za-file-picker__input').simulate('click');expect(props.onChange).not.toHaveBeenCalled();});});