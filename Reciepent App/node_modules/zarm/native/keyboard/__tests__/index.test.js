var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _react=_interopRequireDefault(require("react"));var _enzyme=require("enzyme");var _enzymeToJson=_interopRequireDefault(require("enzyme-to-json"));var _index=_interopRequireDefault(require("../index"));var _Keyboard=_interopRequireDefault(require("../Keyboard"));var _this=this,_jsxFileName="/Users/linji/Documents/workspace/zarm/zarm/components/keyboard/__tests__/index.test.tsx";function mockLongPressTimer(){var longPressTimer;var prop=Symbol('longPressTimer');Object.defineProperty(_Keyboard.default.prototype,'longPressTimer',{get:function get(){return this[prop];},set:function set(timer){longPressTimer=timer;this[prop]=timer;},configurable:true});return{get longPressTimer(){return longPressTimer;}};}describe('Keyboard',function(){describe('snapshot',function(){it('renders correctly',function(){var wrapper=(0,_enzyme.render)(_react.default.createElement(_index.default,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:31,columnNumber:30}}));expect((0,_enzymeToJson.default)(wrapper)).toMatchSnapshot();});it('type is price',function(){var wrapper=(0,_enzyme.render)(_react.default.createElement(_index.default,{type:"price",__self:_this,__source:{fileName:_jsxFileName,lineNumber:36,columnNumber:30}}));expect((0,_enzymeToJson.default)(wrapper)).toMatchSnapshot();});it('type is idcard',function(){var wrapper=(0,_enzyme.render)(_react.default.createElement(_index.default,{type:"idcard",__self:_this,__source:{fileName:_jsxFileName,lineNumber:41,columnNumber:30}}));expect((0,_enzymeToJson.default)(wrapper)).toMatchSnapshot();});});describe('behaviour',function(){afterEach(function(){jest.restoreAllMocks();jest.useRealTimers();});it('should handle touch and mouse click event',function(){var onKeyClick=jest.fn();var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,{onKeyClick:onKeyClick,__self:_this,__source:{fileName:_jsxFileName,lineNumber:53,columnNumber:29}}));var keys=wrapper.find('.za-keyboard__keys');expect(keys.childAt(0).text()).toBe('1');keys.childAt(0).simulate('click');expect(onKeyClick).toBeCalledWith('1');keys.childAt(9).simulate('click');keys.childAt(11).simulate('click');expect(onKeyClick).toBeCalledWith('close');var handles=wrapper.find('.za-keyboard__handle');handles.childAt(0).simulate('touchStart');expect(onKeyClick).toBeCalledWith('delete');handles.childAt(1).simulate('click');expect(onKeyClick).toBeCalledWith('ok');});it("should handle delete operation once if user's touch event gets interrupted",function(){jest.useFakeTimers();var setTimeoutSpy=jest.spyOn(global,'setTimeout');var clearIntervalSpy=jest.spyOn(global,'clearInterval');var setIntervalSpy=jest.spyOn(global,'setInterval');var lazy=mockLongPressTimer();var mOnKeyClick=jest.fn();var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,{onKeyClick:mOnKeyClick,__self:_this,__source:{fileName:_jsxFileName,lineNumber:76,columnNumber:29}}));wrapper.find('.za-keyboard__handle').childAt(0).simulate('touchstart');expect(lazy.longPressTimer).toBeDefined();expect(setTimeoutSpy).toBeCalledWith(expect.any(Function),800);var mEvent={preventDefault:jest.fn()};wrapper.find('.za-keyboard__handle').childAt(0).simulate('touchcancel',mEvent);expect(mEvent.preventDefault).toBeCalledTimes(1);expect(clearIntervalSpy).toBeCalledWith(lazy.longPressTimer);jest.advanceTimersByTime(800);expect(setIntervalSpy).not.toBeCalled();expect(mOnKeyClick).toBeCalledTimes(1);expect(mOnKeyClick.mock.calls).toEqual([['delete']]);jest.advanceTimersByTime(200);expect(mOnKeyClick).toBeCalledTimes(1);});it('should handle delete operation every 100 milliseconds if the user long presses the delete button ',function(){jest.useFakeTimers();var setIntervalSpy=jest.spyOn(global,'setInterval');var lazy=mockLongPressTimer();var mOnKeyClick=jest.fn();var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,{onKeyClick:mOnKeyClick,__self:_this,__source:{fileName:_jsxFileName,lineNumber:97,columnNumber:29}}));wrapper.find('.za-keyboard__handle').childAt(0).simulate('touchstart');var longPressTimerOfSetTimeout=lazy.longPressTimer;expect(longPressTimerOfSetTimeout).toBeDefined();jest.advanceTimersByTime(800);expect(setIntervalSpy).toBeCalledWith(expect.any(Function),100);var longPressTimerOfSetInterval=lazy.longPressTimer;expect(longPressTimerOfSetInterval).toBeDefined();expect(longPressTimerOfSetInterval).not.toEqual(longPressTimerOfSetTimeout);jest.advanceTimersByTime(100);expect(mOnKeyClick).toBeCalledTimes(2);jest.advanceTimersByTime(200);expect(mOnKeyClick).toBeCalledTimes(4);expect(mOnKeyClick.mock.calls).toEqual([['delete'],['delete'],['delete'],['delete']]);});it('should handle ok',function(){var mOnKeyClick=jest.fn();var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,{onKeyClick:mOnKeyClick,__self:_this,__source:{fileName:_jsxFileName,lineNumber:115,columnNumber:29}}));wrapper.find('.za-keyboard__item--ok').simulate('click');expect(mOnKeyClick).toBeCalledWith('ok');});});});