var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _react=_interopRequireDefault(require("react"));var _enzyme=require("enzyme");var _enzymeToJson=_interopRequireDefault(require("enzyme-to-json"));var _index=_interopRequireDefault(require("../index"));var _scroller=_interopRequireDefault(require("../../scroller"));var _jsxFileName="/Users/linji/Documents/workspace/zarm/zarm/components/back-to-top/__tests__/index.test.tsx",_this=this;function genItems(count){var list=[];for(var i=0;i<count;i++){list.push(_react.default.createElement("li",{key:+i,__self:this,__source:{fileName:_jsxFileName,lineNumber:14,columnNumber:15}},"\u7B2C ",i+1," \u884C"));}return list;}describe('BackToTop',function(){var scrollTo;var BackToTopCJS;beforeAll(function(){scrollTo=window.scrollTo;window.scrollTo=jest.fn();});beforeEach(function(){jest.resetModules();});afterEach(function(){jest.restoreAllMocks();});afterAll(function(){window.scrollTo=scrollTo;});describe('snapshot',function(){it('renders correctly',function(){var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:37,columnNumber:29}},"Up"));expect((0,_enzymeToJson.default)(wrapper)).toMatchSnapshot();});it('scrollContainer',function(){var containerStyle={overflowY:'auto',maxHeight:400};var container;var wrapper=(0,_enzyme.mount)(_react.default.createElement(_react.default.Fragment,null,_react.default.createElement("ul",{ref:function ref(ele){container=ele;},style:containerStyle,__self:_this,__source:{fileName:_jsxFileName,lineNumber:49,columnNumber:11}},genItems(100)),_react.default.createElement(_index.default,{scrollContainer:function scrollContainer(){return container;},__self:_this,__source:{fileName:_jsxFileName,lineNumber:57,columnNumber:11}},"Up")));expect((0,_enzymeToJson.default)(wrapper)).toMatchSnapshot();});});it('should handle click event and scroll to the top with animation',function(){var onClick=jest.fn();var wrapper=(0,_enzyme.shallow)(_react.default.createElement(_index.default,{onClick:onClick,__self:_this,__source:{fileName:_jsxFileName,lineNumber:66,columnNumber:29}},"Up"));window.scrollTo(0,1000);jest.useFakeTimers();wrapper.find('.za-back-to-top').simulate('click');jest.runAllTimers();expect(window.scrollTo).toBeCalledWith(0,0);expect(onClick).toBeCalled();});it('should scroll to the top immediately without animation ',function(){var wrapper=(0,_enzyme.shallow)(_react.default.createElement(_index.default,{speed:0,__self:_this,__source:{fileName:_jsxFileName,lineNumber:76,columnNumber:29}},"Up"));window.scrollTo(0,1000);wrapper.find('.za-back-to-top').simulate('click');expect(window.scrollTo).toBeCalledWith(0,0);});it('should append portal container to document body when component did mount',function(){var appendChildSpy=jest.spyOn(document.body,'appendChild');var createElementSpy=jest.spyOn(document,'createElement');var wrapper=(0,_enzyme.shallow)(_react.default.createElement(_index.default,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:85,columnNumber:29}},"Up"));expect(createElementSpy).toBeCalledWith('div');expect(appendChildSpy).toBeCalledWith(wrapper.instance()['portalContainer']);var portalContainer=document.body.querySelector('.za-back-to-top-container');expect(portalContainer).toBeTruthy();});it('should remove portal container from the document body when component will unmount',function(){var removeChildSpy=jest.spyOn(document.body,'removeChild');var wrapper=(0,_enzyme.shallow)(_react.default.createElement(_index.default,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:94,columnNumber:29}},"Up"));var portalContainer=wrapper.instance()['portalContainer'];wrapper.unmount();expect(removeChildSpy).toBeCalledWith(portalContainer);});it('should render null if environment does NOT support DOM',function(){jest.doMock('../../utils/dom',function(){var oDom=jest.requireActual('../../utils/dom');return(0,_extends2.default)({},oDom,{canUseDOM:false});});BackToTopCJS=require('../index').default;var wrapper=(0,_enzyme.shallow)(_react.default.createElement(BackToTopCJS,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:109,columnNumber:29}},"Up"));expect(BackToTopCJS.defaultProps.scrollContainer).toBeUndefined();expect(wrapper.instance()['parent']).toEqual(document.body);expect(wrapper.isEmptyRender()).toBeTruthy();});it('should handle scroll and set visible to false if scrollTop greater than props.visibleDistance',function(){var wrapper=(0,_enzyme.shallow)(_react.default.createElement(_index.default,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:116,columnNumber:29}},"Up"));wrapper.find(_scroller.default).invoke('onScroll')(300);expect(wrapper.find('.za-back-to-top').prop('style')).toEqual({display:'none',position:'fixed',bottom:50,right:50});});it('should use scrollContainer as this.parent',function(){var scrollContainer=document.createElement('div');var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,{scrollContainer:scrollContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:128,columnNumber:27}},"Up"));expect(wrapper.instance()['parent']).toEqual(scrollContainer);});it('should append new portal container if scrollContainer changed',function(){var appendChildSpy=jest.spyOn(document.body,'appendChild');var scrollContainer=document.createElement('div');var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:135,columnNumber:27}},"Up"));wrapper.setProps({scrollContainer:scrollContainer});expect(appendChildSpy).toBeCalledWith(wrapper.instance()['portalContainer']);});it('should render portal with correct style',function(){var scrollContainer=document.createElement('div');var wrapper=(0,_enzyme.mount)(_react.default.createElement(_index.default,{scrollContainer:scrollContainer,style:{color:'blue'},__self:_this,__source:{fileName:_jsxFileName,lineNumber:143,columnNumber:7}},"Up"));wrapper.find(_scroller.default).invoke('onScroll')(500);expect(wrapper.find('.za-back-to-top').prop('style')).toEqual({display:'inline',position:'absolute',bottom:50,right:50,color:'blue'});});});